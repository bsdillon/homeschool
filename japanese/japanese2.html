<html>
  <head>
    <link rel="stylesheet" type="text/css" href="japanese.css">
    <script src="https://bsdillon.github.io/cs200_Spring2020/GoldField/alternate/goldfield.js"></script>
    <script src="japanese.js"></script>
    <style>
      li {font-family: 'Bitstream Cyberbit','Lucida Sans Unicode',  'arial unicode MS','verdana', 'helvetica', 'sans-serif';}
      .floatL {float:left; margin: 10px;}
      .floatR {float:right; margin: 10px;}
      .red {color:red; font-size:48; font-weight:bold;}
      .green {color:green; font-size:48; font-weight:bold;}
      .blue {color:blue; font-size:48; font-weight:bold;}
      em {background: #000000; color: #FFFFAA; font-weight:bold;}
      .large {font-size:48; font-weight:bold;}
      button {width:150;}
    </style>
    <script>
      var sounds = {};
      var hKana = {};
      var kKana = {};

      function loader()
      {
        var audio = document.createElement("audio");
        audio.setAttribute('id', "winAudio");
        var source = document.createElement("source");
        source.setAttribute("src", "https://bsdillon.github.io/cs200_Spring2020/GoldField/winSound.mp3");
        audio.appendChild(source);
        this["winSound"] = audio;
        sounds["winSound"]=this["winSound"];

        var audio = document.createElement("audio");
        audio.setAttribute('id', "loseAudio");
        var source = document.createElement("source");
        source.setAttribute("src", "https://bsdillon.github.io/cs200_Spring2020/GoldField/loseSound.mp3");
        audio.appendChild(source);
        this["loseSound"] = audio;
        sounds["loseSound"]=this["loseSound"];

        hKana['N0']='ん';
        kKana['N0']='ン';

        var keys = ['0I', '0U', 'KI', 'KU', 'KE', 'KO', 'SA', 'SI', 'SO', 'TU', 'NI', 'NE', 'HA', 'HE', 'HO', 'MA', 'RI', 'RU', 'RO', 'WA'];

        for(let i=0;i<keys.length;i++)
        {
          var tmp = function(x){return x===keys[i][0];};
          var c = consonants.findIndex(tmp);
          var tmp = function(x){return x===keys[i][1];};
          var v = vowels.findIndex(tmp);
          
          hKana[keys[i]]=hiraganaTrue[c][v];
          kKana[keys[i]]=katakanaTrue[c][v];
        }

        game();
      }

      function game()
      {
        document.getElementById("reward").innerHTML="";
        var r = Math.floor(Math.random()*3);
        switch(r)
        {
          case 0:
            Identify();
            break;
          case 1:
            Match();
            break;
          case 2:
            Draw();
            break;
        }
      }

      function Match()
      {
        var keys = Object.keys(hKana);
        var index = Math.floor(Math.random()*keys.length);
        var kata = Math.random()>.5;
        var source = kata?kKana[keys[index]]:hKana[keys[index]];
        var target = kata?hKana[keys[index]]:kKana[keys[index]];
        var options = [target];
        var indices = [index];
        for(let i=0;i<4;i++)
        {
          var val = Math.floor(Math.random()*keys.length);
          while(indices.includes(val))
          {
            val = Math.floor(Math.random()*keys.length);
          }
          indices.push(val);
          options.push(kata?hKana[keys[val]]:kKana[keys[val]]);
        }
        document.getElementById("instructions").innerHTML="Which of these characters is a match for <span class='large'>"+source+"</span>";
        var tmp = "<table><tr>";
        while(options.length>0)
        {
          var v = Math.floor(Math.random()*options.length);
          var kana = options[v];
          options.splice(v,1);
          if(kana==target)
          {
            tmp+="<td><button class='large' onclick='win()'>"+kana+"</button></td>";
          }
          else
          {
            tmp+="<td><button class='large' onclick='lose()'>"+kana+"</button></td>";
          }
        }
        tmp+="</tr></table>";
        document.getElementById("output").innerHTML=tmp;
      }

      function Draw()
      {
        var keys = Object.keys(hKana);
        var index = Math.floor(Math.random()*keys.length);
        var kata = Math.random()>.5;
        var source = kata?kKana[keys[index]]:hKana[keys[index]];
        var type = kata?"<span class='red'>katakana</span>":"<span class='blue'>hiragana</span>";
        document.getElementById("instructions").innerHTML="Draw the "+type+" for "+keys[index];
        document.getElementById("output").innerHTML="5 Seconds";
        var tmp = function(){
          document.getElementById("output").innerHTML="<span class='large'>"+source+"</span>";
          document.getElementById("reward").innerHTML="<span class='large'>How'd you do?</span>";
          setTimeout(game,3000);
        }
        setTimeout(tmp,5000);
      }

      function Identify()
      {
        var keys = Object.keys(hKana);
        var index = Math.floor(Math.random()*keys.length);
        var kata = Math.random()>.5;
        var source = kata?kKana[keys[index]]:hKana[keys[index]];
        var target = keys[index];
        var options = [target];
        var indices = [index];
        for(let i=0;i<4;i++)
        {
          var val = Math.floor(Math.random()*keys.length);
          while(indices.includes(val))
          {
            val = Math.floor(Math.random()*keys.length);
          }
          indices.push(val);
          options.push(keys[val]);
        }
        document.getElementById("instructions").innerHTML="Which of these syllables is <span class='large'>"+source+"</span>";
        var tmp = "<table><tr>";
        while(options.length>0)
        {
          var v = Math.floor(Math.random()*options.length);
          var kana = options[v];
          options.splice(v,1);
          if(kana==target)
          {
            tmp+="<td><button class='large' onclick='win()'>"+kana+"</button></td>";
          }
          else
          {
            tmp+="<td><button class='large' onclick='lose()'>"+kana+"</button></td>";
          }
        }
        tmp+="</tr></table>";
        document.getElementById("output").innerHTML=tmp;
      }

      function win()
      {
        //sounds["winSound"].play();
        document.getElementById("reward").innerHTML="<span class='green'>Right!</span>";
        setTimeout(game,3000);
      }

      function lose()
      {
        //sounds["loseSound"].play();
        document.getElementById("reward").innerHTML="<span class='red'>Wrong...</span>";
        setTimeout(game,3000);
      }

      function loader2()
      {
        var newHTML="";
        var count = 0;
        var tag = document.getElementById("tileSpace");
        var row = tag.insertRow();
        var syllables = ["0I","0U","SI","SO","TU","RI","N0","KO","KU","NI","NE","WA","HE"]
        for(let i=0;i<tiles.length;i++)
        {
          var jap = tiles[i].split("_")[0];
          accepted = true;
          for(let j=0;j<jap.length && accepted;j+=2)
          {
            accepted = syllables.includes(jap[j]+jap[j+1]);
          }

          if(accepted)
          {
            var td = row.insertCell();
            var hiraganaType = Math.random()>.5?true:false;
            td.classList.add("tile");
            td.classList.add(hiraganaType?"hiragana":"katakana");
            td.innerHTML = createTileHTML(tiles[i],hiraganaType);
            count++;
          }

          if(count==4)
          {
            row= tag.insertRow();
            count=0;
          }
        }
      }
    </script>
  </head>
  <body onload="loader()">
    <table>
      <tr><td>
        <p id="instructions"></p>
      </td>
      <td id="reward"></td>
      </tr>
      <tr>
        <td colspan="2" id="output"></td>
      </tr>
    </table>
  </body>
</html>